import numpy as np
import pandas as pd
import random
from sklearn.preprocessing import MinMaxScaler
from tensorflow.keras.models import Sequential
from tensorflow.keras.layers import LSTM, Dense, Dropout

# 构建输入数据
charging_data = [
    [10, '內湖區'],
    [6, '南港區'],
    [4, '松山區'],
    [6, '信義區'],
    [6, '大安區'],
    [6, '中正區'],
    [8, '文山區'],
    [12, '中山區'],
    [6, '士林區'],
    [6, '萬華區'],
    [4, '北投區']
]

days = 365 * 5
matrix = [[random.uniform(0.5, 1.1)*item[0] for _ in range(days)] for item in charging_data]
print("行政區域充電功率估算（每天）：")
for idx, item in enumerate(charging_data):
    print(f"{item[1]}區域充電功率：{item[0]}00千瓦，使用情況：{matrix[idx][:5]}...（前5天）")

df = pd.DataFrame(matrix).T
df.columns = [x[1] for x in charging_data]

# 数据预处理
train = df[:-7].values
test = df[-7:].values

scaler = MinMaxScaler()
train = scaler.fit_transform(train)
test = scaler.transform(test)

X_train, y_train = [], []
for i in range(28, len(train)):
    X_train.append(train[i - 28:i])
    y_train.append(train[i])

X_train, y_train = np.array(X_train), np.array(y_train)

# LSTM网络
model = Sequential()
model.add(LSTM(32, return_sequences=True, input_shape=(X_train.shape[1], X_train.shape[2])))
model.add(LSTM(64, return_sequences=False))
model.add(Dropout(0.2))
model.add(Dense(y_train.shape[1]))
model.compile(loss='mean_squared_error', optimizer='adam')

model.fit(X_train, y_train, epochs=30, batch_size=32, verbose=1)

# 预测和评估
X_test = []
for i in range(len(train) - 28, len(train)):
    X_test.append(train[i - 28:i])
X_test = np.array(X_test)

preds = model.predict(X_test)
preds = scaler.inverse_transform(preds)

preds = preds[-7:]
real = test[-7:]

print(preds[-1:])





---------------------------------------------------------------------------------------------------
程式執行結果:

行政區域充電功率估算（每天）：
內湖區區域充電功率：1000千瓦，使用情況：[8.452698759649744, 9.983570523061328, 9.398039745588333, 8.89953306784361, 8.913232463742034]...（前5天）
南港區區域充電功率：600千瓦，使用情況：[6.216451325851268, 6.511368960012199, 5.584653425265843, 6.067164848579008, 5.567689481978173]...（前5天）
松山區區域充電功率：400千瓦，使用情況：[2.7580647883614686, 3.921125643430165, 3.2587763925025337, 2.376126304755028, 3.641455613546821]...（前5天）
信義區區域充電功率：600千瓦，使用情況：[3.6919858472364746, 4.395894989737545, 3.8252979806912135, 4.529675024799577, 4.638279670848514]...（前5天）
大安區區域充電功率：600千瓦，使用情況：[5.031759793085936, 5.4833946139310346, 5.56100332035655, 5.297579217280018, 3.381640413420489]...（前5天）
中正區區域充電功率：600千瓦，使用情況：[4.520112750117825, 3.9434114477612843, 5.152454812816934, 4.651746506970516, 5.880404675980932]...（前5天）
文山區區域充電功率：800千瓦，使用情況：[7.63510276981159, 7.464784842401655, 8.77090439520919, 7.176109539115881, 6.171452746931856]...（前5天）
中山區區域充電功率：1200千瓦，使用情況：[6.563237528375792, 8.215462245961268, 9.333847810493662, 6.329790157272429, 7.981153510754121]...（前5天）
士林區區域充電功率：600千瓦，使用情況：[5.191069597015156, 5.730998741953059, 6.000801288605212, 4.027980508029352, 5.908545571372693]...（前5天）
萬華區區域充電功率：600千瓦，使用情況：[3.874427539840381, 5.266624274646309, 3.221217943743203, 4.130495114240585, 3.192912664698909]...（前5天）
北投區區域充電功率：400千瓦，使用情況：[3.2261008116254297, 3.3903804442089394, 2.20375313507943, 3.856147792888461, 3.5587225836729566]...（前5天）

Epoch 1/30
56/56 [==============================] - 2s 11ms/step - loss: 0.1184
Epoch 2/30
56/56 [==============================] - 1s 11ms/step - loss: 0.0928
Epoch 3/30
56/56 [==============================] - 1s 11ms/step - loss: 0.0916
Epoch 4/30
56/56 [==============================] - 1s 15ms/step - loss: 0.0907
Epoch 5/30
56/56 [==============================] - 1s 12ms/step - loss: 0.0893
Epoch 6/30
56/56 [==============================] - 1s 12ms/step - loss: 0.0893
Epoch 7/30
56/56 [==============================] - 1s 11ms/step - loss: 0.0884
Epoch 8/30
56/56 [==============================] - 1s 12ms/step - loss: 0.0880
Epoch 9/30
56/56 [==============================] - 1s 12ms/step - loss: 0.0881
Epoch 10/30
56/56 [==============================] - 1s 12ms/step - loss: 0.0873
Epoch 11/30
56/56 [==============================] - 1s 11ms/step - loss: 0.0874
Epoch 12/30
56/56 [==============================] - 1s 14ms/step - loss: 0.0871
Epoch 13/30
56/56 [==============================] - 1s 13ms/step - loss: 0.0872
Epoch 14/30
56/56 [==============================] - 1s 12ms/step - loss: 0.0867
Epoch 15/30
56/56 [==============================] - 1s 13ms/step - loss: 0.0862
Epoch 16/30
56/56 [==============================] - 1s 16ms/step - loss: 0.0864
Epoch 17/30
56/56 [==============================] - 1s 16ms/step - loss: 0.0863
Epoch 18/30
56/56 [==============================] - 1s 18ms/step - loss: 0.0861
Epoch 19/30
56/56 [==============================] - 1s 15ms/step - loss: 0.0859
Epoch 20/30
56/56 [==============================] - 1s 14ms/step - loss: 0.0863
Epoch 21/30
56/56 [==============================] - 1s 14ms/step - loss: 0.0860
Epoch 22/30
56/56 [==============================] - 1s 14ms/step - loss: 0.0859
Epoch 23/30
56/56 [==============================] - 1s 14ms/step - loss: 0.0858
Epoch 24/30
56/56 [==============================] - 1s 14ms/step - loss: 0.0856
Epoch 25/30
56/56 [==============================] - 1s 18ms/step - loss: 0.0856
Epoch 26/30
56/56 [==============================] - 1s 15ms/step - loss: 0.0855
Epoch 27/30
56/56 [==============================] - 1s 12ms/step - loss: 0.0856
Epoch 28/30
56/56 [==============================] - 1s 12ms/step - loss: 0.0853
Epoch 29/30
56/56 [==============================] - 1s 12ms/step - loss: 0.0854
Epoch 30/30
56/56 [==============================] - 1s 12ms/step - loss: 0.0853

預測結果: [[7.9258986 4.605898  3.2306788 4.815267  4.776987  4.7299485 6.380075
  9.142354  4.887886  4.699914  3.0892968]]


# -
